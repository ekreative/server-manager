{% extends '::base.html.twig' %}

{% block title %}New Site{% endblock %}

{% block body %}
    {{ form(form) }}
{% endblock %}

{% block javascripts %}
    <script>
        $(".client").chosen({
            no_results_text: "Oops, nothing found!"
        });

        $("#appbundle_site_responsibleManager").chosen({
            no_results_text: "Oops, nothing found!"
        });

        $("#appbundle_site_developer").chosen({
            no_results_text: "Oops, nothing found!"
        });

        $('#appbundle_site_project').on('change', function () {
            var route = "{{ path('project_members') | escape('js') }}";
            $.ajax({
                type: 'POST',
                url: route,
                data: {'projectName': $('#appbundle_site_project').val()},
                success: function (data) {
                    $('#appbundle_site_developer option, #appbundle_site_responsibleManager option').hide();

                    data.developers.forEach(function (item) {
                        $('#appbundle_site_developer').find('option').filter(function(){
                            var developer = $(this).text();
                            return developer.indexOf(item.name)!=-1;
                        }).show();
                    });

                    data.managers.forEach(function (item) {
                        $('#appbundle_site_responsibleManager').find('option').filter(function(){
                            var manager = $(this).text();
                            return manager.indexOf(item.name)!=-1;
                        }).show();
                    });

                    $("#appbundle_site_developer, #appbundle_site_responsibleManager").trigger("chosen:updated");
                },
                error: function (data) {
//                    console.log(data);
                }
            });

//           $('#appbundle_site_responsibleManager').removeAttr('disabled');
//           $('#appbundle_site_developer').removeAttr('disabled');
        });

        var flag = false;
        $('.client').chosen().change( function () {
            if (this.value.toLowerCase() == '') {
                $('.newClient').show();
                flag = true;
            } else {
                if (flag == true){
                    $('.newClient').hide();
                    flag = false;
                }

            }
        }).change();
    </script>
{% endblock %}
